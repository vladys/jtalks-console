import org.jtalks.console.ArtifactVersionsRetriever

apply plugin: 'groovy'

def artifactVersionsRetriever = new ArtifactVersionsRetriever()
task('releases') << {
  print artifactVersionsRetriever.poulpeReleaseVersionsOutput
  print artifactVersionsRetriever.jcommuneReleaseVersionsOutput
}

task('get-poulpe', dependsOn: 'init-dirs') << {
  String address = artifactVersionsRetriever.getPoulpeReleasedWarUrl(hasProperty("poulpeVersion") ? poulpeVersion : null)
  def file = new FileOutputStream("./workdir/apps/" + address.tokenize("/")[-1])
  def out = new BufferedOutputStream(file)
  out << new URL(address).openStream()
  out.close()
}

task('get-server') << {
  String address = "http://ftp.ps.pl/pub/apache/tomcat/tomcat-6/v6.0.35/bin/" + project['server.name'] + ".zip"
  def file = new FileOutputStream("./workdir/servers/" + address.tokenize("/")[-1])
  def out = new BufferedOutputStream(file)
  out << new URL(address).openStream()
  out.close()
}

task('init-dirs') << {
  String[] dirs = ["./workdir/apps", "./workdir/servers", "./workdir/configs"]
  for (String dir : dirs) {
    File file = new File(dir)
    if (!file.exists()) {
      file.mkdirs();
    }
  }
}

task('clean-dirs') << {
  def file = file("./workdir")
  if (file.exists()) {
    file.delete();
  }
}

